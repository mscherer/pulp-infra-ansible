---
- name: Install packages
  package:
    name:
      - podman
      - skopeo
      - jq
    state: present

- name: Copy the deploy script
  template:
    src: deploy_fixtures.sh
    dest: /usr/local/bin/deploy_fixtures.sh
    mode: 0755

- name: Add cron to deploy
  cron:
    minute: "*/5"
    name: Deploy fixtures
    job: /usr/local/bin/deploy_fixtures.sh

- name: Deploy fixtures custom conf
  template:
    dest: /etc/httpd/conf.d/fixtures.pulpproject.org.conf.d/fixtures.conf
    src: fixtures.conf
  notify: verify config and restart httpd
